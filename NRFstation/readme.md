Небольшое описание того как отметку делал я и какие возникли нюансы.
=============================
Схема и плата выполненна в : [Easyeda](https://easyeda.com/burenko/sportiduino-nrf24l01) проект открытый.

Платы заказывались на https://jlcpcb.com/ срок изготовления и доставки в Украину не более 2-х недель. Качество плат отличное.
2 платы вписываются в размер 100х100мм, заказываю 10шт. Итого получается 10*2=20плат за ~12-13$ с доставкой (0,65$ штука)
Оказалось выгоднее заказать 2 раза по 10 плат и получить 40 станций, чем 1 раз 20 плат.

Во вложении 2-ва архивных Gerber файла. С [одной](https://github.com/halny123/sportiduino/blob/master/NRFstation/PCB/Gerber_SportIduinoNRF_v_1.3.8_1pcs_20181008122635.zip) и [двумя](https://github.com/halny123/sportiduino/blob/master/NRFstation/PCB/Gerber_SportIduinoNRF_v_1.3.8_2pcs_20181008122601.zip) платами . 
Выгодней размещать заказ с 2-мя платами. 

------------------------------------------------
{**Схема**](https://github.com/halny123/sportiduino/blob/master/NRFstation/Scheme/Schematic_SportIduino-NRF24l01_Sportiduino-1.3.8_20181008122222.pdf)

Пояснения к схеме:

     U7        - место под разъем для джампера (использую для тестовых плат где нужно отключать питание), тогда R10 не паяем. 
     R10       - перемычка, ставим в готовых изделиях.
     R9        - НЕ СТАВИМ !!! Предполагалось использовать при работе без U2
     C8        - перемычка (не смотрим что обозначенна как конденсатор) 
     S1        - геркон для подачи питания на NRF24l01 и вывода станции их Sleep режима
     LED1,LED2 - на плате место под smd и выводной светодиод. Ставим один какой захотим

------------------------------------------------

Мои действия по изготовлению п.п. и сборке станции в дополнение к описанию Александра Воликова:
================

 ПЕЧАТНАЯ ПЛАТА:
------------
![Платы в сборе](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/PCB.jpg)
Печатные платы делаю оптом (по 10шт) используя паяльную пасту и трафарет.Так выходит намного быстрее. 

10 станций от начала пайки до готового изделия получаются за 6-7часов.

Паяльная паста - MECHANIC XG-80 BGA 60g. (Sn-63%, Pb-37%) ORIGINAL
![Паяльная паста](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/MECHANIC_XG-80_BGA.jpg)


Трафарет далал дома на лазерном принтере (2Вт) из плотной глянцевой бумаги (то что было под рукой). 
Одного трафарета хватило на 30 плат и можно еще пользоваться. На фото трафарет новый и использованный 30раз.
![На фото трафарет новый и использованный 30раз.](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/Trafaret.jpg)

[Файлы для изготовления трафарета в архиве](https://github.com/halny123/sportiduino/blob/master/NRFstation/PCB/TrafaretPCB_1.3.8.rar)

Если живете в большом городе можно заказать (наверное) в фирме по изготовлению рекламы порезку из пластика, тогда трафарет будет вечный.

ЭТАПЫ ИЗГОТОВЛЕНИЯ:
------------
1. Налаживаем на п.п. трафарет и ракелем (обрезок от пластиковой карты) наносим на плату паяльную пасту.
     
  Для удобства работы и позиционирования использую 3-ри дополнительные платы, которые плотно прижимаю к основной и креплю к столу 
  обычным двухсторонним скотчем.
    ![Позиционируем плату и трафарет](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/PCB_Mont.jpg)
    
  Совмещаю трафарет с платой и фиксирую края малярным скотчем.   
     
 ![](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/PCB_Mont1.jpg)
    
  Наносим паяльную пасту.
  Отклеиваем скотч с одной стороны, убираем плату. Повторяем процесс для других плат.
     
  ![](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/PCB_Mont2.jpg)
     

2. Расставляем все компоненты кроме выводных и NRF модуля. Запаиваем феном.
3. Паяльником запаиваем разъем для программирования и детали с обратной стороны платы (LED,R10).
4. Промываем от остатков флюса и получаем плату.
   - ![](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/PCB_SportIduinoNRF_v1.3.8Top.jpg)
5. Прошиваем Optiboot bootloader.(Какие возникли проблемы и как их решил смотрим ниже).
6. Заливаем тестовую прошивку и проверяем работу всего кроме RFID и NRF модулей.
   [Тестовый скетч](https://github.com/halny123/sportiduino/blob/master/NRFstation/TestStation)
7. Если все работает запаиваем RFID и NRF модули и тестируем их.
   RFID - модули предварительно проверяю на дальность считывания меток с помощью тестовой станции с запаянным разъемом под RFID модуль.
   ![Тестовая станция](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/Plata_testRFmodul.jpg)
   т.к. встречались бракованные модули, а выпаивать их после уже лишняя трата времени и сил.
   С перепаянными дросселями нормальная дальность считывания Mifare меток составила : карта - 35мм, брелок - 20мм, браслет - 10мм.
   ![Тест дальности](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/TestRFID_card_read.jpg)
8. Промывка от остатков флюса
9. Подпаиваю питание и помещаю все в корпус. Батареи ставлю без бокса (не доверяю я им), а собираю либо точечной сваркой либо просто пайкой
  и изолирую СИНЕЙ!!! изолентой Ж;-) куда же без нее.


 По компонентам, что использовал и выводы:
------------
- [На плату паяю SMD светодиод](https://ru.aliexpress.com/item/100pcs-Ultra-Bright-3528-LED-SMD-Red-Chip-Surface-Mount-20mA-Light-Emitting-Diode-LED-1210/32765023939.html) - 100шт - 1,62$ .
- [Процессор Atmega 328](https://ru.aliexpress.com/item/Free-Shipping-20pcs-lot-ATMEGA328P-AU-ATMEGA328P-ATMEL-TQFP-44-100-NEW/1608634088.html) брал 40шт притензий нет все работают.
- [RFID RC522](https://ru.aliexpress.com/item/B25-50-SAMIORE-RFID-RC522-13-56-6/32831776989.html) брал 50шт из 40проверенных 
  (3 модуля работают неудовлетворительно) и почти все карточки не рабочие. Брелки рабочие.
- [NRF24l01](https://ru.aliexpress.com/item/Wavgat-10-NRF24L01-2-4/32842054029.html) пробный заказ 10шт все работают отлично.
- [RTC DS3231](https://ru.aliexpress.com/item/in-stock-FQA40N25/32803523536.html) заказал 40шт к качеству есть притензии. Окисленные ножки(плохо паяются)
  из 30 установленных 2шт нерабочие 4шт ведут себя непонятно (есть мысли но пока выводы окончательно сделать не могу)(возможно лучше поискать другого продавца)
- [MCP1700T](https://ru.aliexpress.com/item/50-MCP1700T-3302E-MCP1700T-MCP1700-23/32876878190.html) из 30 проверенных у 3 напряжение 2.9-3.1В остальные 3.2-3.3В

 СБОРКА КОРПУСА:
------------
Что бы быстрее было собирать станцию сделал два приспособления.
Одно для позиционирования сверла при сверлении отверствий под светодиод.
Другое для получение линзы для вклейки в корпус
 
![Все приспособления](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/Konduktor_All.jpg)

В корпусе сверлю с помощью кондуктора сквозное отверстие 3мм.

![Кондуктор для корпуса](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/Konduktor_Box.jpg)
     
С внутренней стороны снимаю фаску сверлом 5мм до наружной стенки.
Покупаю самых дешевых выводных 5мм красных светодиода.
Делаю приспособление из 2-х фанерок 3мм. В одной отверстие 5мм в другой 4-4.5мм. Зажимаю между ними в тисках светодиод. 

![приспособление под светодиод](https://github.com/halny123/sportiduino/blob/master/NRFstation/Images/Konduktor_Led.jpg)
     
Лобзиком спиливаю верхушку светодиода и вклеиваю ее в корпус.
Так получается полностью разборная конструкция в которой плату можно свободно достать из корпуса.

------------------------------------------------
  ПО ПРОШИВКЕ OPTIBOOT :
------------

Изначально столкнулся с проблемами загрузкой через UART прошивок, когда использовал Optiboot из среды Arduino или иных на скоростях выше 38400.

В результате думаю, что дело было в следующем:

По стандарту на RS232 Atmel рекомендует ошибку в скорости передачи до 2%.
При 8МГц тактирования и скорости передачи 115200 ошибка составляет 7,8% при 57600 - 3,7%
До приемлемого уровня ошибка доходит на скоростях от 38400 и ниже.
http://www.robotroom.com/Asynchronous-Serial-Communication-2.html

При добавлении optiboot плат в IDE Arduino  как бало описано у Александра, прошивка происходит на скорости 57600. 
При этом ошибка при стабильном генераторе составит 3,7% а при тактировании от внутреннего генератора  может еще существенно уплыть как в большую так и в меньшую сторону.

Скачал исходник optiboot пересобрал под 8Мгц и скорость 38400 залил и все заработало!

[Здесь вылаживаю свои прошивки Optiboot.](https://github.com/halny123/sportiduino/tree/master/NRFstation/Bootloader_Optiboot)

Их особенности 

- предназначенны для atmega328, 
- тактирование от внутреннего генератора 8Мгц,
- скорость COM порта 38400, 
- после старта первая прошивка мигает 3 раза светодиодом на pin D4, вторая 5 миганий, третья без миганий.

Что я делаю:
------------

создаем папку в {Путь где установлен Arduino}\hardware\arduino\avr\bootloaders\myoptiboot 

[копируем туда файлы загрузчика Bootloader.](https://github.com/halny123/sportiduino/blob/master/NRFstation/Bootloader_Optiboot/bootloaders/myoptiboot)
 
    - optiboot_atmega328_8M_38K400_D4_3flash.hex
    - optiboot_atmega328_8M_38K400_D4_5flash.hex
    - optiboot_atmega328_8M_38K400_NoLedBlink.hex

Добавляем в папку {Путь где установлен Arduino}\hardware\arduino\avr\variants\
[содержимое папки variants](https://github.com/halny123/sportiduino/blob/master/NRFstation/Bootloader_Optiboot/variants/)

Добавляем в конец файла   {Путь где установлен Arduino}\hardware\arduino\avr\boards.txt 

[содержимое файла boards.txt](https://github.com/halny123/sportiduino/blob/master/NRFstation/Bootloader_Optiboot/boards.txt)
                              
 
Запускаем среду Arduino.

В платах появится пункт - **Електронная отметка atmega328p 32 pin TQFP**

Ниже можно будет выбрать один из 3-х загрузчиков, и порог срабатывания схемы BOD (Системы контроля питания).

Дальше прошиваемся по обычной схеме

------------------------------------------------

  Библиотека для NRF
------------
https://github.com/TMRh20

------------------------------------------------
 
[Видео работы первой мелкосерийной партии](https://youtu.be/SSd08Qn7M1Y)
------------
